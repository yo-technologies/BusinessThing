# Document Processing — индексация и подготовка текстовых данных

## Назначение
Document Processing отвечает за асинхронную обработку загруженных документов: извлечение текста, разбиение на логические фрагменты и подготовку векторных представлений для последующего поиска релевантного контента.

## Зона ответственности
- Получение задач на обработку документов из очереди.
- Чтение исходного файла из хранилища.
- Извлечение текстового содержимого из PDF / DOCX / TXT.
- Разбиение текста на чанки по правилам (для поддержки поиска и цитирования).
- Формирование структуры метаданных фрагментов (ссылки на документ, позиция, тип).
- Генерация векторных представлений (embeddings) для каждого чанка.
- Индексация фрагментов в службе векторного поиска.
- Отправка статуса обработки обратно в Core Service.

## Основные сценарии
1. Получение задачи из очереди после регистрации документа.
2. Загрузка файла и извлечение текста.
3. Разбиение текста на чанки и генерация метаданных.
4. Формирование и сохранение векторных описаний во внешнем поисковом хранилище.
5. Отправка статуса «индексирован» или «ошибка обработки».

## Взаимодействия
- Core Service: источник задач (публикация) и прием обновления статуса.
- Хранилище файлов: получение оригинального документа.
- Vector Search Service: запись фрагментов для последующего RAG.

## Требования к качеству данных
- Сохранение связей между чанками и исходным документом (для обратных ссылок и цитат).
- Единообразная структура метаданных для всех типов документов.
- Управление ошибками: в случае сбоя отправка статуса ошибки и причины в Core Service.

## Что не входит в объем (сейчас)
- Выполнение запросов поиска и ранжирования (используется только запись).
- Оркестрация LLM и сбор финального промпта.
