# Core Service — управление организациями, пользователями и документами

## Назначение
Core Service отвечает за базовые бизнес‑сущности и политику доступа: организации, пользователи и их роли, информация об организации, документы и шаблоны/сгенерированные договоры. Сервис обеспечивает целостность данных и выступает единым слоем API для операций CRUD.

## Зона ответственности
- Организация: создание, анкета, обновление.
- Пользователи: приглашения одноразовой ссылкой, принятие приглашения, назначение ролей (Admin, Employee), деактивация.
- Роли и доступ: проверка прав на операции с документами, заметками, шаблонами и интеграциями.
- Заметки LLM об организации: хранение, просмотр, удаление. (прокси в LLM Service)
- Документы: регистрация метаданных загруженных файлов, статусы индексации, связи с организацией и доступом.
- Шаблоны договоров: каталог, описание полей, версии.
- Сгенерированные договоры: хранение метаданных результата (ссылки на файлы, заполненные значения полей).
- Публикация задач на обработку документов в очередь и прием обратных уведомлений о статусе.

## Основные сценарии
1. Создание организации и заполнение анкеты владельцем.
2. Приглашение сотрудников в организацию по одноразовой ссылке и назначение ролей.
3. Управление заметками LLM об организации (просмотр/удаление).
4. Регистрация документа после загрузки файла из клиента: создание записи, установка статуса «ожидает обработку», публикация задачи.
5. Получение уведомления об окончании обработки документа и обновление статуса.
6. Управление шаблонами договоров: список, карточка, поля, версии.
7. Создание записи о сгенерированном договоре (по завершении генерации другим сервисом) и выдача ссылки для скачивания.

## Взаимодействия
- Клиентское приложение: вызывает API для онбординга, управления пользователями, заметками, документами и шаблонами/документами.
- Document Processing: получает задачи на обработку документов и отправляет статусы обратно.
- LLM Service: инициирует запись метаданных о сгенерированных договорах; при необходимости запрашивает данные организации и шаблонов.

## Требования к доступу и безопасности
- Изоляция данных по организациям: пользователь видит только данные своей организации.
- Ролевая модель: операции изменения доступны только в рамках разрешений роли (Admin — полный доступ; Employee — ограниченные операции).
- Валидация прав при всех операциях с документами, заметками и шаблонами.

## Что не входит в объем (сейчас)
- Обработка и извлечение текста из файлов (выполняется Document Processing).
- Непосредственные вызовы моделей ИИ и оркестрация RAG (выполняется LLM Service).
